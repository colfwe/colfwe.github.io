* äººç”Ÿé‡åˆ°è¿‡çš„æœ€ç¦»è°±BUGè¡Œä¸ºæ²¡æœ‰ä¹‹ä¸€-å…³äºglobal-mode-string

** è§£å†³äº†

å¥½äº†ï¼Œæˆ‘å¤§è‡´æ˜ç™½äº†ã€‚åŒæ—¶æˆ‘ä¹Ÿèƒ½è§£é‡Šå•¥æ˜¨æ™šé‚£ä¸ªé€†å¤©ç¦»è°±bugè¡Œä¸ºäº†

å› ä¸ºåœ¨ ~ä»¥å‰~

æœ‰ global-mode-string æ˜¯ç®¡ç†å…¨å±€çš„ modeline ä¿¡æ¯ï¼Œç„¶å mode-line-format æ˜¯ç®¡ç†å±€éƒ¨çš„modelineä¿¡æ¯ï¼Œä¸¤è€…äº’ä¸å¹²æ‰°

ä»¥å‰æˆ‘å¸Œæœ›çŠ¶æ€ä¿¡æ¯èƒ½ä¸€ç›´æ˜¾ç¤ºæ‰€ä»¥ä¸€ç›´éƒ½ä½¿ç”¨çš„ global-mode-string

ä½†æ˜¯æ˜¨æ™špacman -Syuæ›´æ–°ç³»ç»Ÿåï¼Œå˜æˆäº†mode-line-formatç®¡ç†global-mode-stringï¼Œä¸¤è€…ä¸€ä¸ªç®¡ç†å¦ä¸€ä¸ª

æ‰€ä»¥åœ¨ ~ç°åœ¨~

å¯¹å¾… ~global-mode-string~ ä¸ ~mode-line-format~ çš„è¯ï¼ŒåŒæ—¶è¦è®¾ç½® =çŠ¶æ€æ  modeline ä¿¡æ¯= çš„è¯ï¼Œé‚£ä¹ˆå°±æ¯”å¦‚è¿™æ ·æ¥è®¾ç½®å°±å¯ä»¥äº†

#+begin_src elisp
  (defun kivnn/update-modeline-with-all-scripts ()
   "æ˜¾ç¤ºmodelineä¿¡æ¯"

   ;; å°† global-mode-string ä½œä¸º â€œå‰¯modelineä¿¡æ¯â€ æ¥ä½¿ç”¨
   (setq global-mode-string
         (list
          "  "
          (format "ó°„’ TODO %d " modeline-agenda-todo-count)
          (format "ó±¿ DOING %d " modeline-agenda-doing-count)
          (format "ó°• WAIT %d " modeline-agenda-wait-count)
          "- î˜³ "
          modeline-agenda-file-name))

   ;; å°† mode-line-format ä½œä¸º â€œä¸»modelineä¿¡æ¯â€ æ¥ä½¿ç”¨   
   (setq-default mode-line-format
                 '("%e"
                   mode-line-mule-info
                   mode-line-client
                   mode-line-modified
                   mode-line-remote
                   mode-line-frame-identification
                   mode-line-buffer-identification
                   mode-line-position
                   (vc-mode vc-mode)
                   mode-line-modes
                   modeline-calendar-month
                   modeline-calendar-day
                   modeline-time-hour
                   modeline-time-minute
                   modeline-battery-percentage
                   modeline-cpu-temperature
                   modeline-ram-usage
                   
                   ;; ä¸»mode-line-formatï¼Œä½¿ç”¨äº†ï¼Œå‰¯mode-line-format
                   global-mode-string
                   mode-line-format-right-align
                   modeline-emacs-uptime
                   emms-mode-line-string)))
#+end_src

*ä½†è¿™é‡Œå”¯ä¸€å€¼å¾—å¥½å¥‡çš„åœ°æ–¹åœ¨äº: ä¸ºä»€ä¹ˆæˆ‘pacman -Syuæ»šç³»ç»Ÿï¼Œå´ä¼šå½±å“åˆ°é€šè¿‡emacs-mirrosæºç å®‰è£…çš„GNU Emacsï¼Ÿ*

** èƒŒæ™¯ææ–™

æˆ‘æ‰€ä½¿ç”¨çš„ GNU Emacsï¼Œæ˜¯ä» ~emacs-mirror~ ä¸‹æ‹‰å–ç”¨ ~make~ å®‰è£…çš„

æ‰€ä»¥ä¸å­˜åœ¨ä»»ä½•è¢« ~pacman -Syu~ æ»šçš„åŸå› 

åŒæ—¶æˆ‘ä¹Ÿæ²¡æœ‰ä½¿ç”¨ ~package.el~ çš„ ~package-upgrade-all~ æ‰€ä»¥ä¸å­˜åœ¨å‡çº§elåŒ…å¯¼è‡´çš„é—®é¢˜

** å¤ç°æƒ…æ™¯

å½“æ—¶æˆ‘åœ¨ pacman -Syu åï¼Œæˆ‘ä¸€æ‰“å¼€ emacsï¼Œç»“æœ BYD æ•´æ¡ global-mode-string éƒ½ä¸æ˜¾ç¤ºäº†ï¼

ç„¶è€Œ ~C-h v global-mode-string~ æ˜¯æœ‰å€¼çš„ï¼Œä½†æ˜¯å´ä¸æ˜¾ç¤ºï¼Œå¿…é¡»è¦ setq global-mode-string æ‰èƒ½æ˜¾ç¤ºï¼

åæ¥æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œå‘ç°æ˜¯ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„å‡½æ•°æ²¡æœ‰æ‰§è¡Œå¯¼è‡´çš„

#+begin_src elisp
  ;; æ²¡æœ‰åœ¨ after-init-hook æ‰§è¡Œæ­¤ foobar å‡½æ•°
  (defun foobar ()
    (interactive)
    (setq global-mode-string (list)))
#+end_src

å¯å…³é”®çš„åœ°æ–¹åœ¨äº *æˆ‘åœ¨pacman -Syuä¹‹å‰åŒæ ·ä¹Ÿæ˜¯æ²¡æœ‰æ‰§è¡Œ foobar å‡½æ•°çš„ï¼Œä¸ºä»€ä¹ˆä¹‹å‰åœ¨å‡çº§ç³»ç»Ÿå‰åè€Œä¸€åˆ‡æ­£å¸¸ï¼Ÿ*

åŒæ—¶ï¼Œæˆ‘åˆå‘ç°äº†ä¸€ä¸ªé—®é¢˜(*å…¶å®ä¸€éƒ¨åˆ†æ˜¯æˆ‘è‡ªå·±ä¹±å†™å¯¼è‡´çš„ï¼Œä¸€éƒ¨åˆ†å°±æ˜¯å› ä¸ºè¿™ä¸ªsetq global-mode-stringå¯¼è‡´çš„*) 

é¦–å…ˆåœ¨æˆ‘è‡ªå·±è¿™é‡Œ ~emms-mode-line-string~ åŒæ—¶è¢«ä¸¤ä¸ªå‡½æ•°æ§åˆ¶

#+begin_src elisp
  ;; å…¶ä¸€
  (defun kivnn/format-emms-mode-line ()
  "æ ¼å¼åŒ– emms-mode-line-string æ¥æå–éŸ³ä¹çº¯æ–‡ä»¶å"
  (interactive)
  (when (stringp emms-mode-line-string)
    ;; å»æ‰å±æ€§
    (let* ((clean-str (substring-no-properties emms-mode-line-string)))
      (when (string-match ".*/\\([^/]+\\) ]" clean-str)
        (setq emms-mode-line-string
              ;; å»æ‰åç¼€ ".mp3"
              (replace-regexp-in-string "\\.mp3$" "" (match-string 1 clean-str)))))))

  ;; å…¶äºŒ(å½“æ—¶æŠŠemms-mode-line-stringç»™åµŒå…¥åœ°å†™åˆ°kivnn/update-modeline-play-musicé‡Œé¢å»äº†ï¼Œé€»è¾‘å¤ªä¹±äº†ï¼Œè¿™åŒæ ·ç»™æˆ‘è‡ªå·±åé¢Debugæ—¶åŸ‹äº†é¢—å·¨é›·)
  (run-at-time "0 sec" 30    'kivnn/update-modeline-play-music)          ; æ¯30ç§’æ›´æ–°ä¸€æ¬¡å½“å‰æ­£åœ¨æ’­æ”¾çš„éŸ³ä¹å
#+end_src

ç„¶åæˆ‘å°±ç–¯ç‹‚åœ°æ€è€ƒæˆ‘çš„ä»£ç å“ªé‡Œå†™é”™äº†ï¼ŒDebugä»æ™šä¸Š12ç‚¹åˆ°å‡Œæ™¨2ç‚¹è¿‡å

å‘ç°éƒ½ä¸æ˜¯ï¼ä»£ç é€»è¾‘æœ€å¤šå°±æ˜¯æ··ä¹±äº†ç‚¹ï¼Œä½†ç»å¯¹æ²¡æœ‰ä»»ä½•é€»è¾‘é—®é¢˜ï¼å°±æ˜¯ setq global-mode-string å¯¼è‡´çš„

äºæ˜¯æˆ‘å°±é€šè¿‡æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œé€šè¿‡è®¾ç½® ~é’©å­åŠ è½½é¡ºåº~ ç»ˆäºæ˜¯æŠŠè¿™ä¸€ setq global-mode-string æ‰èƒ½æ˜¾ç¤º modeline çš„é—®é¢˜è§£å†³äº†ğŸ˜­

#+begin_src elisp
   ;; æ­¤å¤„çš„ :append æ˜¯æ›²çº¿æ•‘å›½åœ°æ¥è§£å†³ global-mode-string çš„å…³é”®
   (add-hook 'emms-player-started-hook #'kivnn/format-emms-mode-line)
   (add-hook 'emms-player-started-hook #'kivnn/update-modeline-all-information :append)
#+end_src

è´¹äº†ä¹ç‰›äºŒè™ä¹‹åŠ›ï¼Œæˆ‘è¿˜ä»¥ä¸ºæŠ˜è…¾äº†ä¸€æ™šä¸Šçš„é…ç½®ä¼šä¸ç¿¼è€Œé£äº†ğŸ˜­

æ„Ÿè°¢GPTğŸ˜­â™¥ï¸ğŸ™

** ç¦»è°±å‡ºå¤„

*å‡çº§Açš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå´å½±å“åˆ°äº†Bçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œçš„é…ç½®æ–‡ä»¶çš„ç‰¹å®šå˜é‡*

æˆ‘åªè¿›è¡Œäº† pacman -Syuï¼Œæˆ‘ä¹Ÿæ²¡è¿›è¡Œ upgrade-package-all

å´å•ç‹¬å´åªå½±å“åˆ°äº†ä» emacs-mirror ä¸‹æ‹‰å–ç”¨ make å®‰è£…çš„ GNU Emacs çš„ global-mode-string

æ›´é€†å¤©çš„åœ¨äº: æˆ‘çš„ global-mode-string æ˜¯æœ‰å€¼çš„ï¼Œä½†æ˜¯å´éè¦ setq æ‰èƒ½æ˜¾ç¤º

*å‡çº§Açš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå´å½±å“åˆ°äº†Bçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œçš„é…ç½®æ–‡ä»¶çš„ç‰¹å®šå˜é‡*

äººç”Ÿé‡è§è¿‡çš„æœ€ç¦»è°±BUGè¡Œä¸ºï¼ŒçœŸçš„æ²¡æœ‰ä¹‹ä¸€ğŸ˜¢
