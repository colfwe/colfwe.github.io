* åœ¨ArchLinuxä¸Šç»™org-modeæ·»åŠ æ¸²æŸ“ä¸­æ–‡LaTeXç‰‡æ®µçš„æ–¹æ³•

** æŠ˜è…¾åŠ¨æœº

ç”±äº *å› ä¸ºè‡ªå·±åœ¨è¿‡å»å†™çš„ä¸€äº›åœ¨org-modeé‡Œæ¸²æŸ“LaTeXä¸­æ–‡ç‰‡æ®µçš„å‡½æ•°ï¼Œå®åœ¨æ˜¯å†™å¾—è¿‡äºå¦ç±»çŒå¥‡* (æ–‡ç« æœ€åæœ‰è¯´æ€ä¹ˆå®ç°çš„ï¼Œæ€»ä¹‹å°±æ˜¯éå¸¸å¦ç±»ï¼Œä¸»æ‰“ä¸€ä¸ªèƒ½ç”¨å°±è¡Œ)

åŒæ—¶ *å› ä¸ºè‡ªå·±æ²¡æœ‰ä½¿ç”¨ extpfeil å®åŒ…ï¼Œåè€Œæ˜¯è½¬è€Œä½¿ç”¨ç”šè‡³æ»¥ç”¨ä¸‹é¢è¿™ç§æŠ½è±¡åˆ°ç‚¸è£‚çš„åŸç”ŸåŒå‘ç®­å¤´* 

#+begin_src latex
  \underset{ ? }{\stackrel{   }{\leftarrow \!\!\!-\!\!\!-\!\!\!-\!\!\!-\!\!\!-\!\!\!-\!\!\!-\!\!\! \rightarrow}}
#+end_src

å¯¼è‡´å½“orgæ–‡ä»¶å‡ºç°å¤§é‡çš„ ~\!\!\!~ æ—¶ï¼Œè‡ªå·±çš„Emacsåœ¨è§£æå¡åˆ°çˆ†ç‚¸ğŸ’¥ï¼ˆæ˜¯çš„ï¼Œå³ä½¿æ˜¯ feature/igc ä¹Ÿå—ä¸ä½é‚£ç§ï¼Œå³ä½¿ç”¨äº† narrow ä¹Ÿè¿˜æ˜¯å¡å¡çš„é‚£ç§ã€‚ï¼‰

*æˆ‘å¿…é¡»æ‰¿è®¤è¡¨ç¤ºè¿™å°±æ˜¯æˆ‘çš„è´£ä»»ï¼Œåˆ«æƒ³å¤šäº†*


** æ–¹æ¡ˆé€‰æ‹©

è¯¢é—®GPTåï¼ŒGPTè¯´ï¼Œå¡é¡¿çš„åŸå› ä¸»è¦æ˜¯ *[è¾“å‡ºäº†pngè€Œésvg] ä¸ [ç¬¦å·è¿‡å¤š]* çš„é—®é¢˜ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ *é—®é¢˜1: è¾“å‡ºäº†pngè€Œésvg* ä¸ *é—®é¢˜2: \!\!\!çš„ç¬¦å·è¿‡å¤š*

*** é—®é¢˜1: è¾“å‡ºäº†pngè€Œésvg

**** svg çš„ä¼˜åŠ¿ä¹‹å¤„

GPT å›ç­”è¯´ï¼Œä½¿ç”¨ ~SVG~ çš„å¥½å¤„æ˜¯

+ SVG æ˜¯çŸ¢é‡å›¾ï¼Œæ¸²æŸ“æˆæœ¬ä½ï¼Œä¸éœ€è¦ç”¨PNGçš„åƒç´ ç‚¹æè¿°ï¼Œè€Œæ˜¯SVGä½¿ç”¨è·¯å¾„æè¿°ï¼Œæ‰€ä»¥ä¸ä¼šå ç”¨è¿‡å¤šçš„æ˜¾å­˜æˆ–CPUï¼ŒSVGæ¸²æŸ“æˆæœ¬ä½ï¼ŒSVGé€‚åˆå¤§é‡å…¬å¼çš„æ–¹æ¡ˆ

+ ç°åœ¨çš„ Emacs æœ¬èº«å¯¹ SVG çš„æ”¯æŒè¾ƒå¥½

+ SVG ä¸éœ€è¦ç¼“å­˜å¤§é‡å›¾ç‰‡ï¼Œå½“å…¬å¼ç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œå¤„ç† SVG éœ€è¦çš„å†…å­˜å°ï¼ŒåŠ è½½å¿«

æ‰€ä»¥ä½¿ç”¨ *SVG* è€Œé PNGï¼Œåœ¨æˆ‘è‡ªå·±è¿™é‡Œï¼Œè¿«åœ¨çœ‰ç«ã€‚

**** è¾“å‡º èƒ½æ¸²æŸ“ä¸­æ–‡LaTeX çš„ SVG çš„æ–¹æ³•


åœ¨ org-mode é‡Œï¼Œé»˜è®¤æ”¯æŒ dvipngã€dvisvgmã€imagemagick ä¸‰ç§æ¸²æŸ“ LaTeX çš„æ–¹å¼ï¼Œå®ƒä»¬ ~è¾“å‡ºå¯æ˜¾ç¤ºå›¾ç‰‡(PNG æˆ– SVG)~ çš„æ–¹æ¡ˆå¦‚ä¸‹

| åºå· | æ–¹æ¡ˆ                                                                    | æœ€ç»ˆè¾“å‡ºå†…å®¹ |
|------+-------------------------------------------------------------------------+-------------|
|    1 | *dvipng*: ~LaTeX > .dvi > dvipng > PNG~                                 | PNG         |
|    2 | *dvisvgm*: ~LaTeX > .dvi > SVG~                                         | SVG         |
|    3 | *imagemagick*: ~LaTeX > DVI > PostScript > ImageMagick (convert) > PNG~ | PNG         |

ç„¶å org-mode *é»˜è®¤ä½¿ç”¨çš„æ˜¯ dvipng(PNG)* çš„åŸå› æ˜¯

#+begin_quote
å› ä¸ºåœ¨æ—©æœŸçš„ Emacsï¼ŒEmacs 24 å‡ ä¹ä¸æ”¯æŒ svgï¼ŒEmacs 25-25 æœ‰æ”¯æŒä½†ä¸ç¨³å®šã€‚

ä¸€ç›´åˆ° *Emacs 27+ æ‰ç¨³å®šæ”¯æŒ* 

*æ‰€ä»¥å½“åˆä¸ºäº†å¯ä»¥ä½¿ç”¨å¯ä»¥å®ç°å°±è¶³å¤Ÿäº†ï¼ŒåŒæ—¶ç°åœ¨è¿˜èƒ½å‘ä¸‹å…¼å®¹è¿‡å»å·²ç»å…»æˆçš„ä¹ æƒ¯(æ¯•ç«Ÿé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„)* äºæ˜¯é»˜è®¤è®¾ç½® dvipng ä¸ºé»˜è®¤æ¸²æŸ“ LaTeXç‰‡æ®µ çš„æ–¹å¼
#+end_quote

è™½ç„¶ ~dvisvgm~ å¯ä»¥ ~è¾“å‡ºSVG~ ä½† *é—®é¢˜çš„å…³é”®æ˜¯: æ— è®ºæ˜¯ä¸æ˜¯ dvisvgm(SVG)ï¼Œè¿™ä¸‰ç§æ–¹å¼éƒ½é»˜è®¤ä¸æ”¯æŒ [ä¸­æ–‡LaTeXç‰‡æ®µ] çš„æ¸²æŸ“(ä¹Ÿè®¸åŠ å®åŒ…å¯ä»¥å®Œæˆï¼Œä½†æˆ‘è‡ªå·±æ˜¯çœŸçš„æ€ä¹ˆæ‰¾éƒ½æ‰¾ä¸åˆ°ï¼Œè€Œä¸”æˆ‘è‡ªå·±å®åœ¨æ˜¯ä¸æƒ³æŠ˜è…¾äº†)*

äºæ˜¯ä½¿ç”¨å¯¹ä¸­æ–‡æ”¯æŒå‹å¥½çš„ ~XeTeX(æˆ‘è‡ªå·±é€‰æ‹©çš„)~ ä¸ ~LuaTeX~ (å®ƒä»¬çš„å®‰è£…æ–¹å¼éƒ½åœ¨ ~sudo pacman -S texlive~ é‡Œé¢)

**** è®© XeTeX è¾“å‡º SVG

åœ¨ XeTeX é‡Œé¢ *ä¸€å®šæ˜¯PDFè½¬å…¶å®ƒ* ä¸å­˜åœ¨XDVè½¬å…¶å®ƒ (XDVï¼Œå°±æ˜¯DVIçš„XeTeXåŒ…è£…ç‰ˆï¼Œè™½ç„¶XDVçœ‹ä¸Šå»æ˜¯DVIçš„å˜ç§ï¼Œä½†æ˜¯å®é™…ä¸ŠXDVè¿˜æ˜¯PDFçš„å®ç°æ–¹æ³•ï¼Œå¹¶ä¸èƒ½å®Œæˆ XDV to å…¶å®ƒçš„æ–¹æ³•ï¼Œæ‰€ä»¥ *åªèƒ½æ˜¯PDF to å…¶å®ƒ*(*åæ­£æˆ‘è‡ªå·±ç›®å‰äº†è§£åˆ°çš„æ˜¯è¿™æ ·*))

æ‰€ä»¥åœ¨ *PDFè½¬å…¶å®ƒ* çš„æ–¹æ¡ˆä¸‹ï¼Œå°±éœ€è¦ *pdf2svg* æ­¤ä¾èµ–ï¼Œåœ¨ archlinux ä¸‹ï¼Œå¯ä»¥é€šè¿‡

#+begin_src sh  
  # pdf2svgä¾èµ–ï¼Œæ¥è®©XeTeXï¼Œå®ŒæˆPDFè½¬SVGçš„æ–¹æ¡ˆ
  sudo pacman -S pdf2svg
#+end_src

ç„¶åæ‰§è¡Œä¸‹é¢ï¼Œå¦‚æœèƒ½çœ‹åˆ° 114514.svg å°±æ˜¯æˆåŠŸçš„ã€‚

#+begin_src sh
  # sh
  xelatex -no-pdf -output-directory . 114514.tex   # 114514.tex ç”Ÿæˆ 114514.xdv
  xdvipdfmx -E -o 114514.pdf 114514.xdv            # 114514.xdv ç›´æ¥è½¬æ¢æˆ 114514.pdf
  pdf2svg 114514.pdf 114514.svg                    # 114514.pdf å†è½¬æ¢æˆ 114514.svg
#+end_src

ç„¶åä¸‹ä¸€æ­¥åˆ° *è®© XeTeX æ”¯æŒå­—ä½“*

**** è®© XeTeX æ”¯æŒ ä¸­æ–‡å­—ä½“å’Œè¥¿æ–‡å­—ä½“æ··ç”¨

é¦–å…ˆæœ‰ el çš„å®ç°

#+begin_src elisp
  ;; ========================================  
  ;; ä½¿ç”¨ xelatex æ¸²æŸ“ latex-fragment
  ;; ========================================
  (add-to-list 'org-preview-latex-process-alist
               '(xelatex-chinese
                 :programs ("xelatex" "pdf2svg")
                 :description "XeLaTeX with Chinese support (PDF > SVG)"
                 :message "You need to install: xelatex and pdf2svg."
                 ;; æ–¹æ¡ˆ: pdf è½¬ svg
                 :image-input-type "pdf"
                 :image-output-type "svg"
                 :image-size-adjust (1.7 . 1.5)
                 ;; å­—ä½“: ä¸­æ–‡ Noto Sans CJK SC 1.3å€, è¥¿æ–‡ CMU Bright 1.0å€
                 :latex-header "\\documentclass[11pt]{standalone}
                                 \\usepackage{fontspec}
                                 \\setmainfont{Noto Sans CJK SC}[Scale=1.3]
                                 \\setsansfont{CMU Bright}[Scale=1.0]
                                 \\usepackage[usenames]{color}
                                 \\usepackage{amsmath}
                                 \\usepackage{mhchem}
                                 \\usepackage{extpfeil}
                                 \\pagestyle{empty}"
                 :latex-compiler ("xelatex -interaction nonstopmode -output-directory %o %f")
                 ;; ä¾èµ–: pacman -S pdf2svg
                 :image-converter ("pdf2svg %f %O")))
  ;; æ°¸ä¹…è®¾ç½®org-preview-latexçš„é»˜è®¤è¿›ç¨‹ä¸ºä¸Šé¢çš„xelatex-chinese
  (setq org-preview-latex-default-process 'xelatex-chinese)  
#+end_src

ç„¶ååœ¨è¿™é‡Œï¼Œéœ€è¦è¯¦ç»†è§£é‡Šï¼Œå› ä¸º *è¿™æ¶‰åŠåˆ°ä¸€ä¸ª archlinux å­—ä½“å­˜æ”¾æ‰€æœ‰ç›®å½•çš„ä¿®æ”¹* é—®é¢˜ (æˆ‘è‡ªå·±åªæµ‹è¯•è¿‡åœ¨archlinuxå‘è¡Œç‰ˆä¸Šæ˜¯è¿™æ ·çš„ï¼Œå¹¶ä¸çŸ¥é“å…¶å®ƒå‘è¡Œç‰ˆçš„å­—ä½“é…ç½®æ–‡ä»¶æ˜¯ä¸æ˜¯åœ¨ ~/etc/fonts/~ ä¸‹) 
#+begin_src
 \\setmainfont{Noto Sans CJK SC}[Scale=1.3]
 \\setsansfont{CMU Bright}[Scale=1.0]  
#+end_src

åœ¨ä¸­æ–‡LaTeXç‰‡æ®µçš„ *å­—ä½“é€‰æ‹©æ–¹æ¡ˆ: ä¸­æ–‡å­—ä½“ + è¥¿æ–‡å­—ä½“* é‡Œï¼ŒGPT å›ç­”è¯´

| åºå· | ä¸­æ–‡å­—ä½“ï¼ˆCJKï¼‰      | ä¸»è¦å­—ä½“ï¼ˆè¥¿æ–‡éƒ¨åˆ†ï¼‰     | é€‚ç”¨åœºæ™¯            |
|------+---------------------+------------------------+--------------------|
|    1 | Source Han Serif CN | CMU Serif              | é€‚åˆ æ­£å¼è®ºæ–‡ã€ä¹¦ç±  |
|    2 | Source Han Sans CN  | CMU Sans Serif         | é€‚åˆ PPTã€ç°ä»£æ’ç‰ˆ   |
|    3 | Noto Serif CJK SC   | Times New Roman        | é€‚åˆ è‹±æ–‡å­¦æœ¯æ–‡ç«     |
|    4 | FandolSong          | CMU Serif              | é»˜è®¤ LaTeX å…¼å®¹æ€§å¥½ |
|    5 | *Noto Sans CJK SC*  | *Computer Modern Bright*  | *ç°ä»£é£æ ¼ã€å­¦æœ¯æŠ¥å‘Š* |

æˆ‘é€‰æ‹©äº†æ–¹æ¡ˆ5ï¼Œä¸­æ–‡ä½¿ç”¨Noto Sans CJK SC[1.3å€]ã€è¥¿æ–‡ä½¿ç”¨Computer Modern Bright[1.0å€] ï¼ˆå…¶ä¸­ï¼Œå€æ•°çš„è°ƒæ•´æ˜¯åœ¨LaTeXå¯¼è¨€åŒºé‡Œé¢è°ƒæ•´ï¼Œè¿™é‡Œä»…ä½œè¯´æ˜è§£é‡Šï¼‰

å› ä¸ºåœ¨ Emacs é‡Œ *org-modeä½¿ç”¨äº†TeXå¼•æ“çš„å†…ç½®å­—ä½“* å¹¶ä¸”GPTå›ç­”è¯´ï¼Œè¿™æ˜¯ä½¿ç”¨äº† *Computer Modernå­—ä½“ï¼Œå¾ˆæ¼‚äº®* æ¥å®Œæˆ *è¥¿æ–‡LaTeXç‰‡æ®µçš„æ¸²æŸ“çš„* 

æ‰€ä»¥æˆ‘è‡ªå·±çš„å­—ä½“æ–¹æ¡ˆæ˜¯ï¼Œè¥¿æ–‡æœ€å¥½æ˜¯ Computer Modern å°±æ˜¯æœ€å¥½çš„ã€‚

ç„¶åå…³äºè¿™äº›å­—ä½“çš„å®‰è£…ï¼Œé¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œè¿™äº›å­—ä½“å·²ç»åœ¨ *å®‰è£…å¥½texliveå®Œå…¨ä½“ç‰ˆåä¸€å¾‹é™„èµ äº†*

å¦‚æœéƒ½æ˜¯ä½¿ç”¨ archlinux ä½¿ç”¨ pacman æ¥å®‰è£…çš„è¯ï¼Œå®ƒä¼šåœ¨ ~/usr/share/texmf-dist/fonts/~ è¿™é‡Œæœ‰å®‰è£…texliveé™„èµ çš„æ‰€æœ‰çš„å­—ä½“

***** çœæµç‰ˆ

[[https://tex.stackexchange.com/questions/619573/problem-setting-a-main-font/619577#619577][XeTeXé»˜è®¤ä¸è¯†åˆ«texliveçš„é¢å¤–å­—ä½“çš„è§£å†³æ–¹æ³•]]

***** è¯¦ç»†ç‰ˆ

*å‰æå£°æ˜: æˆ‘è‡ªå·±åªæµ‹è¯•äº† archlinux æ˜¯è¿™æ ·çš„ï¼Œæˆ‘è‡ªå·±å¹¶ä¸çŸ¥é“å…¶å®ƒå‘è¡Œç‰ˆä¹Ÿæ˜¯ä¸æ˜¯è¿™æ ·ã€‚*

[[file:../res/texdoc-texlive-æ‰‹å†Œ.png]]  (å…¶ä¸­ï¼Œæ‰‹å†Œæ˜¯å‘½ä»¤è¡Œæ‰§è¡Œ ~texdoc texlive~ å¾—åˆ°çš„)

è€Œä¸”è¿™é‡Œä¹Ÿæœ‰è¯¦ç»†çš„è§£é‡Š

#+begin_src xml
  <!-- bash -->
  <!-- cat /etc/fonts/fonts.conf -->
  
  <!--
          DO NOT EDIT THIS FILE.
          IT WILL BE REPLACED WHEN FONTCONFIG IS UPDATED.
          LOCAL CHANGES BELONG IN 'local.conf'.

          The intent of this standard configuration file is to be adequate for
          most environments.  If you have a reasonably normal environment and
          have found problems with this configuration, they are probably
          things that others will also want fixed.  Please submit any problems
          to the fontconfig issue tracking system located at fontconfig.org

          Note that the normal 'make install' procedure for fontconfig is to
          replace any existing fonts.conf file with the new version.  Place
          any local customizations in local.conf which this file references.

          Keith Packard
  -->  
#+end_src

æ‰€ä»¥åšæ³•å°±æ˜¯ï¼Œå…ˆåˆ›å»ºæ–‡ä»¶ ~sudo vim /etc/fonts/local.conf~ ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹çš„å†…å®¹(*è€Œä¸” ~<?xml version="1.0"?>~ å¿…é¡»åœ¨æ–‡ä»¶çš„ç¬¬1è¡Œ*)

#+begin_src xml
  <?xml version="1.0"?>
  <!DOCTYPE fontconfig SYSTEM "fonts.dtd">
  <fontconfig>
    <!-- Font directory list -->

    <!-- å¦‚æœåªæ·»åŠ å®‰è£…texliveé™„èµ çš„å•ç‹¬ä¸€ç§å­—ä½“ (Compter Modern Unicode)ï¼Œå°±å¼„åˆ°å¯¹åº”çš„å­æ–‡ä»¶å¤¹ -->
    <dir>/usr/share/texmf-dist/fonts/opentype/public/cm-unicode</dir>

    <!-- å¦‚æœåªæ·»åŠ å®‰è£…texliveé™„èµ çš„æ‰€æœ‰å­—ä½“ï¼Œå°±å¼„åˆ°æ ¹æ–‡ä»¶å¤¹ -->
    <dir>/usr/share/texmf-dist/fonts/opentype</dir>    
  </fontconfig>  
#+end_src


ç„¶åæ‰§è¡Œ ~fc-cache -fsv~ å°±ä¼šçœ‹åˆ°ï¼Œå°±è¯´æ˜å®‰è£…å¥½äº† (*æˆ‘è¿™é‡Œæ˜¯åªå®‰è£…äº† CMU è¿™ä¸€ä¸ªå­—ä½“*)

#+begin_example
Font directories:
        /usr/share/fonts
        /usr/local/share/fonts
        /usr/share/texmf-dist/fonts/opentype/public/cm-unicode
        .......................................................
#+end_example

äºæ˜¯ï¼ŒæŸ¥çœ‹æ‰€æœ‰å®‰è£…å¥½çš„ CMU å­—ä½“

#+begin_src sh
  # bash
  fc-list | grep '^/usr/share/texmf-dist/fonts/opentype/public/cm-unicode/'  
#+end_src

ç„¶åæ¥ä¸‹æ¥å›åˆ° Emacs çš„é…ç½®ï¼Œäºæ˜¯å°±æœ‰

#+begin_src elisp
  ;; ========================================  
  ;; ä½¿ç”¨ xelatex æ¸²æŸ“ latex-fragment
  ;; ========================================
  (add-to-list 'org-preview-latex-process-alist
               '(xelatex-chinese
                 :programs ("xelatex" "pdf2svg")
                 :description "XeLaTeX with Chinese support (PDF > SVG)"
                 :message "You need to install: xelatex and pdf2svg."
                 ;; æ–¹æ¡ˆ: pdf è½¬ svg
                 :image-input-type "pdf"
                 :image-output-type "svg"
                 :image-size-adjust (1.7 . 1.5)
                 ;; å­—ä½“: ä¸­æ–‡ Noto Sans CJK SC 1.3å€, è¥¿æ–‡ CMU Bright 1.0å€
                 :latex-header "\\documentclass[11pt]{standalone}
                                 \\usepackage{fontspec}
                                 \\setmainfont{Noto Sans CJK SC}[Scale=1.3]
                                 \\setsansfont{CMU Bright}[Scale=1.0]
                                 \\usepackage[usenames]{color}
                                 \\usepackage{amsmath}
                                 \\usepackage{mhchem}
                                 \\usepackage{extpfeil}
                                 \\pagestyle{empty}"
                 :latex-compiler ("xelatex -interaction nonstopmode -output-directory %o %f")
                 ;; ä¾èµ–: pacman -S pdf2svg
                 :image-converter ("pdf2svg %f %O")))
  ;; æ°¸ä¹…è®¾ç½®org-preview-latexçš„é»˜è®¤è¿›ç¨‹ä¸ºä¸Šé¢çš„xelatex-chinese
  (setq org-preview-latex-default-process 'xelatex-chinese)  
#+end_src

å°±å¯ä»¥ç”Ÿæ•ˆäº†ï¼Œæ¥ä¸‹æ¥æ‰“å¼€ GNU Emacsï¼Œç„¶å ~æ‰§è¡Œ org-latex-preview~ æˆ– ~æŒ‰ä¸‹ C-c C-x C-l~ å°±å¯ä»¥æ¸²æŸ“æ‰€æœ‰çš„ä¸­æ–‡è¥¿æ–‡æ··åˆçš„LaTeXç‰‡æ®µäº†


*** é—®é¢˜2: \!\!\!çš„ç¬¦å·è¿‡å¤š

é€ æˆè¿™æ ·çš„åŸå›  *ä»…ä»…åªæ˜¯æˆ‘è¿‡å»è¿‡äºæ‡’æƒ°å¯¼è‡´çš„ï¼Œä¸æ„¿æ„åŠ å®åŒ…ï¼Œå¯¼è‡´éå¸¸å¤¸å¼ çš„ç¼–è¾‘å¡é¡¿é—®é¢˜*

æ–¹æ³•å°±æ˜¯åŠ å…¥å®åŒ…å°±æ˜¯äº†: *åœ¨ä¸Šé¢çš„ xelatex-chinese åŠ å…¥ extpfeil* å®åŒ…ï¼Œå¹¶ä¸”åœ¨cdlatexé‡ŒåŠ å…¥ç±»ä¼¼çš„å¿«é€ŸæŒ‡ä»¤ï¼Œæ¯”å¦‚ ~ae, ar, al~ ç­‰(è¿™ä¸ªè‡ªå·±è®¾ç½®å“ˆï¼)

#+begin_src elisp
  ("ae" "" "\\stackrel{\\text{ ? }}{\\underset{\\text{  }}{\\xLeftrightarrow{\\hspace{3cm}}}} " cdlatex-position-cursor nil nil t)
  ("al" "" "\\stackrel{\\text{ ? }}{\\underset{\\text{  }}{\\xLeftarrow{\\hspace{3cm}}}} " cdlatex-position-cursor nil nil t)
  ("ar" "" "\\stackrel{\\text{ ? }}{\\underset{\\text{  }}{\\xRightarrow{\\hspace{3cm}}}} " cdlatex-position-cursor nil nil t)  
#+end_src

äºæ˜¯ä¸€åˆ‡å°± OK äº†


** å¦ç±»å®ç°æ–¹æ³•ï¼ˆåƒä¸‡åˆ«å­¦ï¼è¦æ¸²æŸ“ä¸­æ–‡LaTeXç‰‡æ®µè¯·çœ‹ä¸Šé¢ï¼ï¼‰

å…ˆè®¾ç½®ä¸€ä¸ª *xelatex-chinese* çš„è‡ªå®šä¹‰è®¾ç½®

#+begin_src elisp
  ;; ========================================  
  ;; ä½¿ç”¨ xelatex æ¸²æŸ“ latex-fragment
  ;; ========================================
  (add-to-list 'org-preview-latex-process-alist
               '(xelatex-chinese
                 :programs ("xelatex" "convert")
                 :description "XeLaTeX with Chinese support dvi > png"
                 :message "you need to install the programs: xelatex and divpng."
                 :image-input-type "pdf"
                 :image-output-type "png"
                 :image-size-adjust (1.7 . 1.5)
                 :latex-header "\\documentclass[11pt]{standalone}
                                        \\usepackage{fontspec}
                                        \\setmainfont{Source Han Sans CN}
                                        \\setsansfont{Source Han Sans CN}
                                        \\usepackage[usenames]{color}
                                        \\usepackage{amsmath}
                                        \\pagestyle{empty}"
                 :latex-compiler ("xelatex -interaction nonstopmode -output-directory %o %f")
                 :image-converter ("convert -density 90 -background '#FFFFFF' -flatten -quality 100 %f %O")))  
#+end_src

å†è®¾ç½®ä¸€ä¸ªå¦‚æœåœ¨LaTeXç‰‡æ®µä¸­é‡åˆ°ä¸­æ–‡ï¼Œå°± *éœ€è¦è‡ªå·±æ‰‹åŠ¨æŒ‰ä¸‹å¿«æ·é”®æ¥æ‰§è¡Œå‡½æ•°* çš„å‡½æ•°

#+begin_src elisp
;; =======================================
;; åŠ¨æ€é€‰æ‹©å¼•æ“æ¥æ¸²æŸ“
;; =======================================
(defun kivnn/format-org-latex-preview-with-utf8 ()
  "æ¸²æŸ“åœ¨org-modeä¸‹æ¸²æŸ“å«æœ‰utf-8å­—ç¬¦çš„LaTeXç‰‡æ®µä¹‹å‰çš„æ ¼å¼åŒ–å‡†å¤‡"
  (interactive)
  ;; æ‰¾åˆ°å·¦è¾¹ç•Œ
  (let ((thing (thing-at-point 'line t)))
    (if (and thing (string-match (concat variable-latex-fragment-left-bound ".*" variable-latex-fragment-right-bound) thing))
        (search-backward variable-latex-fragment-left-bound nil t)
      (message "no such equation, please check again...")))
  (forward-char 2)
  (delete-all-space)
  ;; æ‰¾åˆ°å³è¾¹ç•Œ
  (let ((thing (thing-at-point 'line t)))
    (if (and thing (string-match (concat variable-latex-fragment-left-bound ".*" variable-latex-fragment-right-bound) thing))
        (search-forward variable-latex-fragment-right-bound nil t)
      (message "no such equation, please check again...")))
  (backward-char 3)
  (delete-all-space))

(defun kivnn/org-latex-preview-with-utf8 ()
  "åœ¨org-modeä¸‹æ¸²æŸ“å«æœ‰utf-8å­—ç¬¦çš„LaTeXç‰‡æ®µ"
  (interactive)
  (let* ((latex-code (thing-at-point 'line t))
         (is-utf8 (and latex-code
                       (string-match (concat variable-latex-fragment-left-bound ".*" variable-latex-fragment-right-bound) latex-code)
                       (string-match-p "[^\x00-\x7F]" latex-code))))
    (if is-utf8
        ;; å¦‚æœåŒ…å« UTF-8 å­—ç¬¦ï¼Œå°±ä½¿ç”¨ xelatex-chinese å¼•æ“
        (progn
          (setq org-preview-latex-default-process 'xelatex-chinese)
          (message "ç›®å‰ä½¿ç”¨äº†xelatex-chineseå¼•æ“æ¸²æŸ“æ­¤LaTeXç‰‡æ®µ"))
      ;; å¦‚æœä¸åŒ…å« UTF-8 å­—ç¬¦ï¼Œå°±ä½¿ç”¨ dvipngã€dvisvgmã€imagemagick å¼•æ“
      (setq org-preview-latex-default-process 'dvipng)                       
      (message "ç›®å‰ä½¿ç”¨äº†org-modeé»˜è®¤çš„dvipngã€dvisvgmã€imagemagickå¼•æ“æ¸²æŸ“æ­¤LaTeXç‰‡æ®µ"))
    (org-latex-preview)
    ;; æ¯æ¬¡æ‰§è¡Œå®Œæ¯•åéƒ½æ¢å¤ä¸º dvipngã€dvisvgmã€imagemagick å¼•æ“
    (setq org-preview-latex-default-process 'dvipng)
    (message "Creating Latex previews in section...(and recover dvipng...) done.")))

(defun kivnn/render-latex-fragment-utf8 ()
  "åœ¨org-modeä¸‹æ¸²æŸ“å«æœ‰utf-8å­—ç¬¦çš„LaTeXç‰‡æ®µçš„ç»„åˆå‡½æ•°"
  (interactive)
  (kivnn/format-org-latex-preview-with-utf8)
  (kivnn/org-latex-preview-with-utf8))  
#+end_src

ç¼ºç‚¹ï¼ˆç”¨åˆ°ç°åœ¨æ›´æ¢äº†ä»¥åæˆ‘æ‰æ˜ç™½ï¼Œè¿™æœ‰å¤šä¸æ–¹ä¾¿ï¼Œè¿™æœ‰å¤šä¹ˆæ¶å¿ƒ Â´_>ï¼‰

+ å¿…é¡»è‡ªå·±æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªæŒ‰ \\( å…‰æ ‡å¿…é¡»æ”¾åœ¨æ­¤ä¸Šä¸‹æ–‡èŒƒå›´é‡Œé¢ï¼Œç„¶åå†æŒ‰ä¸‹å¿«æ·é”®æ‰§è¡Œ \\) æ›´æ¢æˆæœ€ä¸Šé¢çš„å®ç°åï¼Œæˆ‘æ‰å‘ç°è¿™æœ‰å¤šä¹ˆä¸æ–¹ä¾¿ (Â´_>)

+ å¿…é¡»è‡ªå·±å®ç° \\(åˆ é™¤å·¦è¾¹ç•Œç©ºæ ¼    åˆ é™¤å³è¾¹ç•Œç©ºæ ¼\\) çš„å‡½æ•°ï¼Œå¦åˆ™å°±ä¼šå‡ºç° *LaTeXç‰‡æ®µè‡ªå¸¦ç©ºæ ¼* çš„æƒ…å†µ  (Â´_>)

+ å¦‚æœå› ä¸ºä»€ä¹ˆäº‹æƒ…ï¼Œè¦é‡æ–°æ¸²æŸ“æ‰€æœ‰LaTeXç‰‡æ®µçš„è¯ï¼Œé‚£ä¹ˆå°†å…‰æ ‡æ”¾åœ¨ä¸€ä¸ªä¸€ä¸ªçš„ \\( \\) èŒƒå›´é‡Œé¢æ‰‹åŠ¨æŒ‰å¿«æ·é”®ï¼ŒæŒ‰å¾—äººéƒ½éº»äº†ã€‚æˆ‘ä»¥ä¸ºä»¥å‰è¿™æ ·å°±æ˜¯æœ€å®Œç¾çš„ï¼Œä½†æ˜¯ç°åœ¨æ‰çŸ¥é“ä»¥å‰æœ‰å¤šä¹ˆä¸æ–¹ä¾¿å‘¢  (Â´_>)

  
